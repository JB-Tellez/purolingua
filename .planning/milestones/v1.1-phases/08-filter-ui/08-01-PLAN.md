---
phase: 08-filter-ui
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - tests/filter-ui.test.js
autonomous: true
requirements:
  - FLTR-01
  - FLTR-09

must_haves:
  truths:
    - "tests/filter-ui.test.js exists and all tests fail (RED) before any implementation"
    - "i18n key tests assert filters.levelA1 and filters.levelA2 resolve to non-empty strings in both it and es locales"
    - "chip-state tests assert renderFilterChips() syncs .active CSS class based on getActiveLevels()"
  artifacts:
    - path: "tests/filter-ui.test.js"
      provides: "Failing test suite for FLTR-01 chip behavior and FLTR-09 i18n key presence"
      min_lines: 40
  key_links:
    - from: "tests/filter-ui.test.js"
      to: "src/locales/it/ui.js"
      via: "direct import of it locale module"
      pattern: "import.*it/ui"
    - from: "tests/filter-ui.test.js"
      to: "src/locales/es/ui.js"
      via: "direct import of es locale module"
      pattern: "import.*es/ui"
    - from: "tests/filter-ui.test.js"
      to: "src/js/core/state.js"
      via: "import getActiveLevels, setActiveLevels"
      pattern: "getActiveLevels|setActiveLevels"
---

<objective>
Create the failing test suite (RED phase) for Phase 8 filter UI behavior before any implementation exists.

Purpose: Establishes the spec for FLTR-01 (chip toggle) and FLTR-09 (i18n labels) in executable form. Tests must fail initially to confirm they test real behavior — not vacuous assertions.
Output: tests/filter-ui.test.js with failing tests covering i18n key presence and chip active-state sync.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-filter-logic/07-03-SUMMARY.md
@.planning/phases/07-filter-logic/07-04-SUMMARY.md
@.planning/phases/08-filter-ui/08-RESEARCH.md
@tests/filter-logic.test.js
@tests/vitest.setup.js
</context>

<feature>
  <name>filter-ui test suite (RED)</name>
  <files>tests/filter-ui.test.js</files>
  <behavior>
    FLTR-09 — i18n key presence (both locales):
    - `itUI.filters.levelA1` is a non-empty string
    - `itUI.filters.levelA2` is a non-empty string
    - `esUI.filters.levelA1` is a non-empty string
    - `esUI.filters.levelA2` is a non-empty string

    FLTR-01 — renderFilterChips() active-state sync:
    - When activeLevels is ['A1'], calling renderFilterChips() on a DOM fixture
      adds .active to the A1 chip and removes it from A2
    - When activeLevels is ['A1', 'A2'], both chips get .active
    - When activeLevels is ['A2'], A2 chip gets .active; A1 does not

    Note: renderFilterChips() is not yet exported in Phase 8 Plan 01. The test
    file must import it — this import will fail at RED time, which is correct.
    The test file structure must be valid Vitest syntax so it runs (and fails for
    the right reason: missing export or missing i18n key).
  </behavior>
  <implementation>
    Follow the pattern in tests/filter-logic.test.js:
    - Direct module imports (no mocking)
    - beforeEach sets localStorage.setItem('language-learning-locale', 'it')
      and calls setActiveLevels(['A1']) to establish a known state
    - Use vitest.setup.js localStorage mock that is already configured

    File structure:
    1. Import block — import itUI from '../src/locales/it/ui.js'; import esUI
       from '../src/locales/es/ui.js'; import { getActiveLevels, setActiveLevels }
       from '../src/js/core/state.js'; import { renderFilterChips } from
       '../src/js/core/app.js'
    2. describe('FLTR-09: i18n filter key presence') — 4 it() tests, one per key
       per locale. Each test: expect(key).toBeTruthy() and
       expect(typeof key).toBe('string'). These fail in RED because filters
       namespace does not exist in either locale file yet.
    3. describe('FLTR-01: renderFilterChips active state sync') — 3 it() tests.
       Each test:
         a. Create minimal DOM: two button elements with class 'filter-chip' and
            data-level='A1' / data-level='A2', appended to document.body
         b. Call setActiveLevels(testCase) then renderFilterChips()
         c. Assert chip.classList.contains('active') as expected
         d. Clean up: remove chip buttons from document.body in afterEach

    IMPORTANT: renderFilterChips will not be exported yet in RED phase. Import
    must be present (will cause a module error or undefined). Wrap the FLTR-01
    describe in a conditional or let the import fail — either way the test suite
    will be in RED. Prefer: import it normally; if renderFilterChips is undefined
    the tests will throw 'not a function', which counts as RED failure.
  </implementation>
</feature>

<tasks>

<task type="auto">
  <name>Task 1: Write failing filter-ui.test.js (RED)</name>
  <files>tests/filter-ui.test.js</files>
  <action>
    Create tests/filter-ui.test.js with the following structure:

    ```js
    import { describe, it, expect, beforeEach, afterEach } from 'vitest';
    import itUI from '../src/locales/it/ui.js';
    import esUI from '../src/locales/es/ui.js';
    import { setActiveLevels } from '../src/js/core/state.js';
    import { renderFilterChips } from '../src/js/core/app.js';

    // FLTR-09: i18n filter key presence
    describe('FLTR-09: i18n filter key presence', () => {
        it('it locale has filters.levelA1 string', () => {
            expect(itUI.filters?.levelA1).toBeTruthy();
            expect(typeof itUI.filters?.levelA1).toBe('string');
        });
        it('it locale has filters.levelA2 string', () => {
            expect(itUI.filters?.levelA2).toBeTruthy();
            expect(typeof itUI.filters?.levelA2).toBe('string');
        });
        it('es locale has filters.levelA1 string', () => {
            expect(esUI.filters?.levelA1).toBeTruthy();
            expect(typeof esUI.filters?.levelA1).toBe('string');
        });
        it('es locale has filters.levelA2 string', () => {
            expect(esUI.filters?.levelA2).toBeTruthy();
            expect(typeof esUI.filters?.levelA2).toBe('string');
        });
    });

    // FLTR-01: renderFilterChips() active-state sync
    describe('FLTR-01: renderFilterChips active state sync', () => {
        let chipA1, chipA2;

        beforeEach(() => {
            chipA1 = document.createElement('button');
            chipA1.className = 'filter-chip';
            chipA1.dataset.level = 'A1';
            chipA2 = document.createElement('button');
            chipA2.className = 'filter-chip';
            chipA2.dataset.level = 'A2';
            document.body.appendChild(chipA1);
            document.body.appendChild(chipA2);
        });

        afterEach(() => {
            chipA1.remove();
            chipA2.remove();
        });

        it('A1-only: A1 chip gets .active, A2 does not', () => {
            setActiveLevels(['A1']);
            renderFilterChips();
            expect(chipA1.classList.contains('active')).toBe(true);
            expect(chipA2.classList.contains('active')).toBe(false);
        });

        it('A2-only: A2 chip gets .active, A1 does not', () => {
            setActiveLevels(['A2']);
            renderFilterChips();
            expect(chipA1.classList.contains('active')).toBe(false);
            expect(chipA2.classList.contains('active')).toBe(true);
        });

        it('A1+A2: both chips get .active', () => {
            setActiveLevels(['A1', 'A2']);
            renderFilterChips();
            expect(chipA1.classList.contains('active')).toBe(true);
            expect(chipA2.classList.contains('active')).toBe(true);
        });
    });
    ```

    Run `bun run test -- tests/filter-ui.test.js` to confirm RED state.
    Expected: 4 FLTR-09 tests fail (itUI.filters is undefined) and 3 FLTR-01
    tests fail (renderFilterChips is not exported / is undefined).
  </action>
  <verify>
    <automated>bun run test -- tests/filter-ui.test.js 2>&1 | tail -20</automated>
    <manual>Confirm test output shows failures (not syntax errors). All 7 tests must appear in output and fail. If tests error on import, that is acceptable RED — the key is the file is syntactically valid and the suite runs.</manual>
    <sampling_rate>Run immediately after writing the file, before committing</sampling_rate>
  </verify>
  <done>tests/filter-ui.test.js exists; `bun run test -- tests/filter-ui.test.js` runs and all 7 tests fail for expected reasons (missing i18n keys, missing renderFilterChips export)</done>
</task>

</tasks>

<verification>
`bun run test` — all existing tests still pass; filter-ui.test.js shows failures only.
</verification>

<success_criteria>
tests/filter-ui.test.js created with 7 failing tests (4 FLTR-09 + 3 FLTR-01). Existing test suite (filter-logic, deck-utils, progress, data-integrity, audio, app) remains green. RED phase confirmed.
</success_criteria>

<output>
After completion, create `.planning/phases/08-filter-ui/08-01-SUMMARY.md`
</output>
